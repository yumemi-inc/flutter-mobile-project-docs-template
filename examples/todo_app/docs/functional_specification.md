# TODO アプリケーション 機能仕様書

## 1. 機能概要

### 1.1 目的

ユーザーが日々のタスクを効率的に管理・追跡できるモバイルアプリケーション

### 1.2 対象ユーザー

- 個人のタスク管理を行いたいユーザー
- シンプルで直感的なツールを求めるユーザー
- スマートフォンを主要デバイスとするユーザー

### 1.3 主要機能

1. タスクの作成・編集・削除
2. タスクの完了管理
3. タスクの一覧表示
4. カテゴリ管理
5. 検索・フィルタ機能
6. データ永続化（SQLiteデータベース）
7. リマインダー・通知機能

## 2. ユーザーストーリー

### 2.1 基本機能

#### US-001: タスク作成

```
As a ユーザー
I want to 新しいタスクを作成する
So that 忘れたくない作業を記録できる

受入基準:
- タスクのタイトルを入力できる
- タスクの説明を入力できる（任意）
- 優先度を設定できる（高・中・低）
- 期限を設定できる（任意）
- カテゴリを選択できる（任意）
- 作成後、タスクリストに表示される
```

#### US-002: タスク表示

```
As a ユーザー
I want to タスクの一覧を見る
So that 現在のタスク状況を把握できる

受入基準:
- 未完了タスクと完了済みタスクが区別されて表示される
- タスクは作成日時順（新しいものが上）で表示される
- 各タスクにタイトル、期限、優先度が表示される
- 完了済みタスクは視覚的に区別される（グレーアウトなど）
```

#### US-003: タスク完了

```
As a ユーザー
I want to タスクを完了状態にする
So that 完了したタスクを管理できる

受入基準:
- チェックボックスをタップして完了/未完了を切り替えられる
- 完了時に視覚的フィードバックがある
- 完了時刻が記録される
- 完了済みタスクは別セクションに移動する
```

#### US-004: タスク編集

```
As a ユーザー
I want to 既存のタスクを編集する
So that 内容を修正・追加できる

受入基準:
- タスクをタップして編集画面に遷移する
- タスクアイテムの長押しで編集メニューを表示できる
- タイトル、説明、期限、優先度、カテゴリを変更できる
- 編集前の内容が入力済みで表示される
- 変更を保存またはキャンセルできる
- 更新日時が記録される
- 編集後は元の画面に戻る
```

#### US-005: タスク削除

```
As a ユーザー
I want to 不要なタスクを削除する
So that リストを整理できる

受入基準:
- スワイプアクションで削除オプションが表示される
- 削除前に確認ダイアログが表示される
- 削除は取り消せない（将来的にゴミ箱機能を検討）
```

### 2.2 拡張機能

#### US-006: カテゴリ管理

```
As a ユーザー
I want to タスクをカテゴリ別に分類する
So that 用途別にタスクを管理できる

受入基準:
- プリセットカテゴリ（仕事、個人、買い物、健康）が用意されている
- カスタムカテゴリを作成できる
- カテゴリごとに色分けされる
- カテゴリ別でタスクをフィルタできる
```

#### US-007: 検索・フィルタ

```
As a ユーザー
I want to タスクを検索・フィルタする
So that 特定のタスクを素早く見つけられる

受入基準:
- メイン画面上部に検索バーが設置される
- タイトルと説明でテキスト検索ができる
- 検索結果はリアルタイムに絞り込まれる
- 検索バーにキーワードを入力すると該当タスクのみ表示される
- 優先度でフィルタできる
- カテゴリでフィルタできる
- 完了状態でフィルタできる
- 期限でフィルタできる（今日、明日、来週など）
```

#### US-008: データ永続化

```
As a ユーザー
I want to アプリを閉じてもタスクデータが保持される
So that データを失うことなく継続的にアプリを使用できる

受入基準:
- アプリ終了後もタスクデータが保持される
- アプリ起動時に前回のデータが自動的にロードされる
- SQLiteデータベースを使用してローカルに保存される
- データ破損時の復旧機能が提供される
- アプリ更新時の自動マイグレーション機能
```

#### US-009: リマインダー設定

```
As a ユーザー
I want to タスクにリマインダーを設定する
So that 重要なタスクを忘れることなく実行できる

受入基準:
- タスク作成・編集画面でリマインダー日時を設定できる
- リマインダーのON/OFFを切り替えるトグルスイッチがある
- 日時ピッカーでリマインダー日時を選択できる
- 1つのタスクにつき1つのリマインダーまで設定可能
- リマインダー日時が表示される
- リマインダーを削除できる
```

#### US-010: リマインダー通知

```
As a ユーザー
I want to リマインダー日時に通知を受け取る
So that タスクの実行を忘れることを防げる

受入基準:
- 設定したリマインダー日時にプッシュ通知が表示される
- 通知にはタスクのタイトルが表示される
- 通知をタップするとアプリが起動してタスク詳細が表示される
- アプリがバックグラウンドでも通知が動作する
- 通知の許可設定が適切に管理される
```

## 3. 詳細機能仕様

### 3.1 タスク管理機能

#### 3.1.1 タスクデータモデル

```
Task {
  id: UUID (自動生成)
  title: String (1-100文字, 必須)
  description: String (0-500文字, 任意)
  priority: Enum (High, Medium, Low)
  category: String (任意)
  dueDate: DateTime (任意)
  isCompleted: Boolean (デフォルト: false)
  completedAt: DateTime (任意)
  reminderDateTime: DateTime (任意) // 新規追加: リマインダー日時
  createdAt: DateTime (自動設定)
  updatedAt: DateTime (自動更新)
}
```

#### 3.1.2 タスク作成フロー

1. FABボタンまたは「+」ボタンをタップ
2. タスク作成画面が表示される
3. 必須項目（タイトル）を入力
4. 任意項目（説明、期限、優先度、カテゴリ）を設定
5. 「保存」ボタンをタップ
6. バリデーション実行
7. 成功時：メイン画面に戻り、新しいタスクが表示される
8. 失敗時：エラーメッセージを表示

#### 3.1.3 タスク編集フロー

1. タスクアイテムをタップまたは長押し
2. タスク編集画面が表示される
3. 既存の値が入力済みで表示される
4. 必要な項目（タイトル、説明など）を修正
5. 「保存」ボタンをタップ
6. バリデーション実行
7. 成功時：updatedAtを更新し、メイン画面に戻る
8. 失敗時：エラーメッセージを表示
9. 「キャンセル」ボタンで変更を破棄して元の画面に戻る

#### 3.1.4 タスク表示仕様

- **未完了タスク**: 上部に表示
- **完了済みタスク**: 下部に折りたたみ可能なセクションで表示
- **ソート順**: 優先度（高→中→低）、次に作成日時（新→古）
- **表示項目**: タイトル、期限、優先度アイコン、カテゴリ色

### 3.2 カテゴリ管理機能

#### 3.2.1 プリセットカテゴリ

- 🏢 仕事 (Work) - 青色
- 👤 個人 (Personal) - 緑色
- 🛒 買い物 (Shopping) - オレンジ色
- ❤️ 健康 (Health) - 赤色

#### 3.2.2 カスタムカテゴリ

- ユーザーが自由に作成可能
- カテゴリ名（1-20文字）と色を選択
- 絵文字アイコンも選択可能
- 削除時は関連タスクを未分類に変更

### 3.3 検索・フィルタ機能

#### 3.3.1 検索機能

- メイン画面上部に検索バーを配置
- 全文検索（タイトル・説明対象）
- リアルタイム検索（入力中に結果を更新）
- 検索キーワードを含むタスクのみを絞り込み表示
- 検索結果は通常のタスクリスト形式で表示
- 検索履歴の保存（最大10件）
- 検索バーのクリアボタンで検索状態を解除

#### 3.3.2 フィルタ機能

- **期限フィルタ**: 今日、明日、今週、来週、期限なし
- **優先度フィルタ**: 高、中、低
- **カテゴリフィルタ**: 全カテゴリから選択
- **状態フィルタ**: 未完了、完了済み、全て

### 3.4 データ永続化機能（新規追加）

#### 3.4.1 SQLiteデータベース

- **ライブラリ**: `sqflite` パッケージを使用
- **データベース名**: `todo_app.db`
- **テーブル設計**: 
  - tasks テーブル：タスクデータの管理
  - categories テーブル：カテゴリデータの管理
- **インデックス**: タスク検索とフィルタ処理の最適化

#### 3.4.2 データアクセス層

- **Repository パターン**: データアクセスロジックの抽象化
- **CRUD操作**: Create, Read, Update, Delete の完全実装
- **トランザクション**: データ整合性保証のための適切な実装
- **エラーハンドリング**: データベースエラーの適切な処理

#### 3.4.3 マイグレーション機能

- **バージョン管理**: データベーススキーマのバージョン管理
- **自動マイグレーション**: アプリ更新時の自動スキーマ変更
- **後方互換性**: 既存データの保持とスキーマ変更の両立

### 3.5 リマインダー・通知機能（新規追加）

#### 3.5.1 リマインダー設定

- **設定画面**: タスク作成・編集画面内にリマインダー設定セクション
- **日時選択**: 日付・時刻ピッカーによる直感的な設定
- **制限**: 1タスクにつき1つのリマインダーまで
- **バリデーション**: 過去の日時設定不可、適切な警告表示

#### 3.5.2 通知スケジューリング

- **ローカル通知**: デバイスのローカル通知機能を使用
- **スケジューリング**: 設定日時での正確な通知配信
- **通知ID管理**: タスクIDベースの通知識別
- **通知更新**: リマインダー変更時の既存通知の適切な更新・削除

#### 3.5.3 通知処理

- **通知内容**: タスクタイトルとカスタムメッセージ
- **通知アクション**: 通知タップでアプリ起動とタスク表示
- **バックグラウンド処理**: アプリ非アクティブ時の通知機能
- **権限管理**: 通知権限の確認と適切な権限リクエスト

## 4. 画面仕様

### 4.1 メイン画面（タスクリスト）

- **ヘッダー**: タイトル、設定アイコン
- **検索バー**: テキスト入力欄、クリアボタン（上部に配置）
- **ボディ**:
  - 未完了タスクセクション
  - 完了済みタスクセクション（折りたたみ可能）
- **フッター**: FABボタン（タスク追加）
- **画面遷移**: タスクアイテムタップで編集画面へ遷移

### 4.2 タスク作成・編集画面

- **ヘッダー**: 戻るボタン、タイトル（「タスク作成」または「タスク編集」）、保存ボタン
- **フォーム**:
  - タイトル入力欄（編集時は既存値を表示）
  - 説明入力欄（複数行、編集時は既存値を表示）
  - 期限設定（日付・時刻ピッカー）
  - 優先度選択（セグメンテッドコントロール）
  - カテゴリ選択（ドロップダウン）
  - **リマインダー設定セクション（新規追加）**:
    - リマインダーON/OFFトグルスイッチ
    - リマインダー日時ピッカー（ONの時のみ表示）
    - 設定済みリマインダー日時の表示
- **フッター**: 保存ボタン、キャンセルボタン

### 4.3 検索・フィルタ画面

- **検索バー**: テキスト入力、クリアボタン
- **フィルタオプション**: チップ形式で表示
- **検索結果**: メイン画面と同様のリスト形式

### 4.4 設定画面

- **カテゴリ管理**: 追加、編集、削除
- **アプリ情報**: バージョン、利用規約、プライバシーポリシー

## 5. ユーザビリティ要件

### 5.1 操作性

- タップ領域は44px以上を確保
- スワイプ操作でタスク削除
- 長押しでクイックアクション表示
- 片手操作を考慮したレイアウト

### 5.2 視覚的フィードバック

- ボタンタップ時のハイライト効果
- タスク完了時のアニメーション
- 読み込み中のローディング表示
- エラー時の分かりやすいメッセージ

### 5.3 アクセシビリティ

- VoiceOverサポート
- 動的文字サイズ対応
- ハイコントラストモード対応
- タップ領域の最適化

## 6. パフォーマンス要件

### 6.1 応答性

- アプリ起動時間: 3秒以内
- 画面遷移時間: 1秒以内
- タスク追加・更新: 500ms以内
- 検索結果表示: 200ms以内

### 6.2 メモリ使用量

- 最大メモリ使用量: 50MB以下
- メモリリーク対策の実装
- 大量タスク（1000件以上）での動作保証

### 6.3 バッテリー効率

- バックグラウンド処理の最小化
- CPUリソースの最適化

## 7. データ要件

### 7.1 データ永続化（強化）

- **データベース**: SQLite データベースを使用（shared_preferencesから変更）
- **自動保存**: アプリ終了時に自動的にデータを保存
- **自動ロード**: アプリ起動時に自動的にデータをロード
- **オフライン機能**: 完全なオフライン対応
- **データ整合性**: トランザクション制御による保証
- **マイグレーション**: アプリ更新時の自動スキーマ変更対応

### 7.2 データ移行

- アプリ更新時の自動マイグレーション
- データ破損時の復旧機能

### 7.3 データ容量

- 最大タスク数: 10,000件
- 最大カテゴリ数: 100件
- 総データサイズ: 10MB以下を想定

## 8. 将来的な機能拡張

### 8.1 リマインダー・通知機能（新規追加）

#### 8.1.1 リマインダー設定機能

- **設定方法**: タスク作成・編集画面でリマインダー日時を設定
- **制限事項**: 1タスクにつき1つのリマインダーまで
- **日時選択**: 日付・時刻ピッカーでの詳細設定
- **ON/OFF制御**: トグルスイッチによる簡単な有効/無効切り替え

#### 8.1.2 通知機能

- **通知タイミング**: 設定されたリマインダー日時に正確に通知
- **通知内容**: タスクタイトルを含む分かりやすい通知メッセージ
- **通知操作**: 通知タップでアプリ起動とタスク詳細表示
- **バックグラウンド動作**: アプリが起動していない状態でも通知機能が動作
- **権限管理**: 通知権限の適切な取得と管理

#### 8.1.3 使用技術

- **通知ライブラリ**: `flutter_local_notifications` パッケージ
- **プラットフォーム対応**: iOS・Android両プラットフォーム対応
- **通知チャンネル**: Android向けの適切な通知チャンネル設定

### 8.2 フェーズ2で検討する機能

- タスクの繰り返し設定
- サブタスク機能
- タスクテンプレート
- 統計・レポート機能
- 複数リマインダー設定

### 8.3 フェーズ3で検討する機能

- 音声入力
- AI によるタスク提案

### 8.4 長期的な展望

- ウェアラブルデバイス対応
- デスクトップアプリ連携
- 機械学習による最適化提案

## 9. 非機能要件

### 9.1 セキュリティ

- ローカルデータの保護
- アプリロック機能（生体認証）
- プライバシー情報の適切な取り扱い

### 9.2 可用性

- オフライン環境での完全動作
- 異常終了からの自動復旧

### 9.3 保守性

- モジュール化された設計
- 包括的なテストカバレッジ
- 詳細なログ出力機能

## 10. まとめ

本機能仕様書では、TODOアプリケーションの包括的な機能要件を定義しました。ユーザー中心設計のアプローチにより、直感的で効率的なタスク管理体験を提供することを目指しています。

**ステップ3で追加された主要機能**:
- **データ永続化の強化**: SQLiteデータベースによる堅牢なローカルデータ管理
- **リマインダー機能**: タスクの忘れ防止のための通知システム

これらの機能により、ユーザーはアプリを閉じてもデータが失われることなく、重要なタスクを見逃すことなく効率的なタスク管理が可能になります。段階的な開発により、基本機能から高度な機能まで順次実装し、ユーザーニーズに応える高品質なアプリケーションを構築します。
