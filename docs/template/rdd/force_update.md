<!--
このドキュメントは「強制/任意アップデート」機能の詳細機能要件定義書のテンプレートです。

【使い方】
- 本テンプレートはアプリの強制/任意アップデート機能の詳細な要件を整理・共有するためのものです。
- 必要に応じて要件を追加・修正してください。
- 用語や表現の統一、重複の回避に注意してください。
- 本テンプレートではFirebase RemoteConfigをサンプルとして使用しています。サーバーAPI経由など他の手段を用いる場合は、適宜内容を書き換えてください。

【カラム説明】
| カテゴリ | 機能名 | 機能の説明 | 備考 | テクニカルノート |
|-|-|-|-|-|
| カテゴリ | 機能の名称 | 機能説明 | 補足事項や関連情報 | バリデーションやRemoteConfigキー名など技術情報 |
-->

# 強制/任意アップデート機能 詳細機能要件定義書テンプレート

## 概要

<!--
このセクションには、強制/任意アップデート機能の目的や背景、利用シーンなどを記載してください。
-->

本ドキュメントは、スマートフォンアプリにおける「強制/任意アップデート」機能の詳細な要件を定義します。ユーザーに最新バージョンの利用を促し、セキュリティや機能の向上を図ることを目的とします。Firebase RemoteConfigを利用してアップデートの有無や種別を制御します。

## 機能一覧

<!--
このセクションには、強制/任意アップデート機能に含まれる主な機能を一覧で記載してください。
- 例としてよくある業務要件を記載しています。不要なものは削除し、必要に応じて追加・修正してください。
-->

<!-- markdownlint-disable MD033 -->

| カテゴリ | 機能名 | 機能の説明 | 備考 | テクニカルノート |
|-|-|-|-|-|
| 共通 | 設定値取得 | Firebase RemoteConfigからアップデート設定値を取得する | | RemoteConfigキー名: force_update_version, optional_update_version など |
| 共通 | バージョンアップダイアログ表示 | 表示された強制/任意バージョンアップダイアログを表示する<br>アプリストアへ遷移し、アプリのバージョンを更新する。 | | 任意ダイアログにはスキップボタンを表示する |
| 強制アップデート| 有効設定 | 現在のアプリバージョンがforce_update_version以下だった場合、端末は強制バージョンアップを有効状態に設定する。 | | |
| | 無効設定 | 現在のアプリバージョンがforce_update_version以上だった場合、端末は強制バージョンアップを無効状態に設定する。 | | |
| 任意アップデート| 有効設定 | 現在のアプリバージョンがoptional_update_version以下だった場合、端末は任意バージョンアップを有効状態に設定する。<br><br> スキップを可能とする。 | | |
| | 無効設定 | 現在のアプリバージョンがforce_update_version以上だった場合、端末は任意バージョンアップを無効状態に設定する。 | | |

<!-- markdownlint-enable MD033 -->

## シナリオ

<!--
このセクションには、強制/任意アップデート機能の主な利用シナリオやユーザーフローを記載してください。
- 例としてよくある業務要件を記載しています。不要なものは削除し、必要に応じて追加・修正してください。
- シナリオが簡単な場合は文章で、複雑な場合はフロー図（シーケンス図や状態遷移図など）で記載することも検討してください。
-->

1. アプリ起動時またはフォアグラウンド復帰時にRemoteConfigからアップデート設定値を取得する。
2. 取得したバージョン情報と現在のアプリバージョンを比較する。
3. 強制アップデート対象の場合、強制アップデートダイアログを表示し、ユーザー操作をブロック。
4. 任意アップデート対象の場合、任意アップデートダイアログを表示し、ユーザーはアップデートまたはスキップを選択可能。
5. 設定値取得に失敗した場合は、リトライまたはデフォルト値で動作。
6. ユーザーが「アップデート」選択時、アプリストアへ遷移。

## 強制/任意バージョンアップの設定値を設置する場所

<!--
このセクションには、強制/任意アップデートの設定値をどこに設置・管理するかを記載してください。
- 例としてよくある配置場所を記載しています。不要なものは削除し、必要に応じて追加・修正してください。
-->

- Firebase RemoteConfigのパラメータとして設置

## 強制/任意バージョンアップの設定値

<!--
このセクションには、RemoteConfigで管理する主な設定値とその説明を記載してください。
- 例としてよくある設定値を記載しています。不要なものは削除し、必要に応じて追加・修正してください。
-->

| 設定値名 | 説明 | 例 |
|-|-|-|
| force_update_version | 強制アップデートを要求する最小バージョン | 2.0.0 |
| optional_update_version | 任意アップデートを促す最小バージョン | 2.1.0 |

## 強制/任意バージョンアップのダイアログ表示タイミング

<!--
このセクションには、アップデートダイアログを表示するタイミングや条件を記載してください。
- 例としてよくある表示タイミングを記載しています。不要なものは削除し、必要に応じて追加・修正してください。
-->

- アプリ起動時
- アプリがバックグラウンドからフォアグラウンドに復帰した時
- RemoteConfigの設定値取得後、バージョン判定時

### 強制/任意バージョンアップの設定値取得失敗時の対応

<!--
このセクションには、RemoteConfigの設定値取得に失敗した場合の対応方針を記載してください。
- 例としてよくある失敗時の対応を記載しています。不要なものは削除し、必要に応じて追加・修正してください。
-->

- 設定値取得に失敗した場合は、一定回数リトライを行う
- リトライ上限を超えた場合は、デフォルト値で判定を行う
- デフォルト値も取得できない場合は、アップデートダイアログを表示しない（通常起動を許可）
